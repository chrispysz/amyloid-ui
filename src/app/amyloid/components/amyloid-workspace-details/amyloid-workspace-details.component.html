<ng-template #content let-modal>
  <div class="modal-header">
    <h3 class="modal-title" id="modal-basic-title">
      {{ editActionDescription }} sequence
    </h3>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <div class="mb-3">
      <form [formGroup]="sequenceDetailsModal">
        <label for="sequenceIdentifier">Identifier</label>
        <div class="input-group">
          <input
            formControlName="sequenceIdentifier"
            id="sequenceIdentifier"
            class="form-control"
            type="text"
          />

          <div class="container-fluid">
            <small
              id="sequenceIdentifierHelperText"
              class="form-text text-muted"
            >
              Sequence identifier must be 2-30 characters long.
            </small>
          </div>
        </div>
        <div class="container" style="margin-top: 20px"></div>
        <label for="sequenceValue">Sequence</label>
        <div class="input-group">
          <input
            formControlName="sequenceValue"
            id="sequenceValue"
            class="form-control"
            type="text"
          />

          <div class="container-fluid">
            <small
              id="sequenceIdentifierHelperText"
              class="form-text text-muted"
            >
              Sequence must be 40-500 characters long.
            </small>
          </div>
        </div>
        <div class="d-grid d-md-flex justify-content-md-end">
          <button
            type="submit"
            [disabled]="sequenceDetailsModal.invalid"
            class="btn btn btn-outline-primary"
            (click)="modal.close(sequenceDetailsModal.value)"
          >
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal-footer"></div>
</ng-template>
<ng-template #content2 let-modal>
  <div class="modal-header">
    <h3 class="modal-title" id="modal-basic-title">Prediction results</h3>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <div class="mb-3">
      <textarea readonly id="predictLogs" rows="10" cols="60">
        {{ selectedSequenceResults }}
      </textarea>
    </div>
  </div>

  <div class="modal-footer"></div>
</ng-template>
<div class="container">
  <button
    class="btn btn-secondary"
    style="font-weight: bold"
    name="Add sequence"
    (click)="openEditModal(content, 'Add', '', '', '')"
  >
    <span class="btn-label" style="font-weight: bold"
      ><i class="bi bi-folder-plus"></i
    ></span>
    Add sequence
  </button>
  <div class="table-responsive">
    <table class="table table-hover table-striped">
      <thead>
        <tr>
          <th scope="col"></th>
          <th scope="col">Identifier</th>
          <th scope="col">Actions</th>
          <th scope="col">Status</th>
          <th scope="col">Sequence</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngIf="true">
          <tr *ngFor="let sequence of sequences; index as i">
            <th scope="row">{{ i + 1 }}</th>
            <td>{{ sequence.name }}</td>
            <td>
              <button
                class="btn btn-empty"
                name="Predict"
                (click)="predict(sequence.value, sequence.id)"
                [disabled]="predictionInProgress"
                style="outline: none; border: none"
                placement="bottom"
                ngbTooltip="Run prediction for this sequence"
              >
                <span class="btn-label"
                  ><i
                    class="bi bi-fast-forward-circle"
                    style="font-size: 1.5rem"
                  ></i
                ></span>
              </button>
              <button
                class="btn btn-empty"
                name="Edit"
                (click)="
                  openEditModal(
                    content,
                    'Edit',
                    sequence.name,
                    sequence.value,
                    sequence.id
                  )
                "
                [disabled]="predictionInProgress"
                style="outline: none; border: none"
                placement="bottom"
                ngbTooltip="Edit sequence"
              >
                <span class="btn-label"
                  ><i class="bi bi-pencil-square" style="font-size: 1.5rem"></i
                ></span>
              </button>
              <button
                class="btn btn-empty"
                name="Results"
                (click)="openResultsModal(content2, sequence.predictLog)"
                [disabled]="predictionInProgress"
                style="outline: none; border: none"
                placement="bottom"
                ngbTooltip="Display detailed results"
              >
                <span class="btn-label"
                  ><i class="bi bi-eye" style="font-size: 1.5rem"></i
                ></span>
              </button>
              <button
                class="btn btn-empty"
                name="Delete"
                (click)="deleteSequence(sequence.id, sequence.name)"
                [disabled]="predictionInProgress"
                style="outline: none; border: none"
                placement="bottom"
                ngbTooltip="Delete sequence"
              >
                <span class="btn-label"
                  ><i class="bi bi-trash" style="font-size: 1.5rem"></i
                ></span>
              </button>
            </td>
            <td>
              <div *ngIf="sequence.state === 'PENDING'">
                <i class="bi bi-question" style="font-size: 2rem"></i>
              </div>
              <div *ngIf="sequence.state === 'POSITIVE'">
                <i class="bi bi-chevron-up text-success" style="font-size: 2rem"></i>
              </div>
              <div *ngIf="sequence.state === 'NEGATIVE'">
                <i class="bi bi-chevron-down text-danger" style="font-size: 2rem"></i>
              </div>
            </td>
            <td
              style="word-wrap: break-word; min-width: 200px; max-width: 200px"
            >
              <ng-container
                *ngIf="
                  predictionInProgress && idBeingPredicted === sequence.id;
                  else sequenceValue
                "
              >
                <div>
                  <ngb-progressbar type="success" [value]="predictionProgress"
                    >Predicting sequence
                    <b>{{ currentSequenceNumber }}/{{ lastSequenceNumber }}</b
                    >...</ngb-progressbar
                  >
                </div>
              </ng-container>
            </td>
            <ng-template #sequenceValue>{{ sequence.value }}</ng-template>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>
