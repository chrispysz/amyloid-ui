<ng-template #content let-modal>
  <div class="modal-header">
    <h3 class="modal-title" id="modal-basic-title">
      {{ editActionDescription }} sequence
    </h3>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <div class="mb-3">
      <form [formGroup]="sequenceDetailsModal">
        <label for="sequenceIdentifier">Identifier</label>
        <div class="input-group">
          <input
            formControlName="sequenceIdentifier"
            id="sequenceIdentifier"
            class="form-control"
            type="text"
          />

          <div class="container-fluid">
            <small
              id="sequenceIdentifierHelperText"
              class="form-text text-muted"
            >
              Sequence identifier must be 2-30 characters long.
            </small>
          </div>
        </div>
        <div class="container" style="margin-top: 20px"></div>
        <label for="sequenceValue">Sequence</label>
        <div class="input-group">
          <input
            formControlName="sequenceValue"
            id="sequenceValue"
            class="form-control"
            type="text"
          />

          <div class="container-fluid">
            <small
              id="sequenceIdentifierHelperText"
              class="form-text text-muted"
            >
              Sequence must be 40-500 characters long.
            </small>
          </div>
        </div>
        <div class="d-grid d-md-flex justify-content-md-end">
          <button
            type="submit"
            [disabled]="sequenceDetailsModal.invalid"
            class="btn btn btn-outline-primary"
            (click)="modal.close(sequenceDetailsModal.value)"
          >
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal-footer"></div>
</ng-template>
<ng-template #content2 let-modal>
  <div class="modal-header">
    <h3 class="modal-title" id="modal-basic-title">Prediction results</h3>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    Select a model: 
    <select #models class="form-select mb-3" style="width: 20%;" (change)="onModelSelect(models.value)" aria-label="Model selection">
      <option selected value="AmBERT">AmBERT</option>
      <option value="LSTM">LSTM</option>
    </select>
    <app-amyloid-detailed-results
      [sequence]="logFilteredSequence"
    ></app-amyloid-detailed-results>
  </div>
</ng-template>
<ng-template #content3 let-offcanvas>
  <div class="offcanvas-header">
    <h4 class="offcanvas-title" id="offcanvas-basic-title">Model selection</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="offcanvas.dismiss()"
    ></button>
  </div>
  <div class="offcanvas-body">
    <app-amyloid-model-card (modelSelected)="handleModelClicked($event)">
    </app-amyloid-model-card>
  </div>
</ng-template>
<div class="container">
  <div *ngIf="predictionProgress > 0">
    <p>
      <ngb-progressbar
        style="background: #6e85b7"
        [animated]="true"
        type="success"
        [value]="predictionProgress"
        [striped]="true"
        ><em>{{ predictionProgress }}%</em></ngb-progressbar
      >
    </p>
  </div>
  <button
    class="btn btn-secondary"
    style="
      font-weight: bold;
      border-radius: 0px;
      border-top-left-radius: 15px;
      margin-left: 1px;
      margin-right: 1px;
    "
    name="Add sequence"
    [disabled]="predictionInProgress"
    (click)="openEditModal(content, 'Add', '', '', '')"
  >
    <span class="btn-label" style="font-weight: bold"
      ><em class="bi bi-folder-plus"></em
    ></span>
    Add sequence
  </button>
  <button
    class="btn btn-secondary"
    style="font-weight: bold; margin-right: 1px; border-radius: 0px"
    name="Select model"
    [disabled]="predictionInProgress"
    (click)="openOffCanvas(content3)"
  >
    <span class="btn-label" style="font-weight: bold"
      ><em class="bi bi-robot"></em
    ></span>
    Models
  </button>
  <button
    class="btn btn-secondary"
    style="font-weight: bold; border-radius: 0px"
    name="Predict all"
    [disabled]="predictionInProgress"
    (click)="predictAll('AmBERT')"
  >
    <span class="btn-label" style="font-weight: bold"
      ><em class="bi bi-play"></em
    ></span>
    Predict all
  </button>
  <button
    class="btn btn-secondary"
    style="
      font-weight: bold;
      border-radius: 0px;
      border-top-right-radius: 15px;
      margin-left: 1px;
    "
    name="Predict all"
    [disabled]="predictionInProgress"
    [routerLink]="['/amyloid/settings', workspace.id]"
  >
    <span class="btn-label" style="font-weight: bold"
      ><em class="bi bi-gear"></em
    ></span>
    Settings
  </button>

  <div class="table-responsive">
    <table class="table table-hover table-striped">
      <thead>
        <tr>
          <th scope="col"></th>
          <th scope="col">Identifier</th>
          <th scope="col">Actions</th>
          <th scope="col">Status</th>
          <th scope="col">Sequence</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngIf="true">
          <tr *ngFor="let sequence of sequences; index as i">
            <th scope="row">{{ i + 1 }}</th>
            <td>{{ sequence.name }}</td>
            <td>
              <button
                class="btn btn-empty"
                name="Predict"
                (click)="predict(sequence.value, sequence.id, 'AmBERT')"
                [disabled]="predictionInProgress"
                style="
                  outline: none;
                  border: none;
                  padding: 0px;
                  margin-right: 5px;
                "
                placement="bottom"
                ngbTooltip="Run prediction for this sequence"
              >
                <span class="btn-label"
                  ><em class="bi bi-play-circle" style="font-size: 1.5rem"></em
                ></span>
              </button>
              <button
                class="btn btn-empty"
                name="Edit"
                (click)="
                  openEditModal(
                    content,
                    'Edit',
                    sequence.name,
                    sequence.value,
                    sequence.id
                  )
                "
                [disabled]="predictionInProgress"
                style="outline: none; border: none; padding: 5px"
                placement="bottom"
                ngbTooltip="Edit sequence"
              >
                <span class="btn-label"
                  ><em
                    class="bi bi-pencil-square"
                    style="font-size: 1.5rem"
                  ></em
                ></span>
              </button>
              <button
                class="btn btn-empty"
                name="Results"
                (click)="openResultsModal(content2, sequence)"
                [disabled]="predictionInProgress"
                style="outline: none; border: none; padding: 5px"
                placement="bottom"
                ngbTooltip="Display detailed results"
              >
                <span class="btn-label"
                  ><em class="bi bi-eye" style="font-size: 1.5rem"></em
                ></span>
              </button>
              <button
                class="btn btn-empty"
                name="Delete"
                (click)="deleteSequence(sequence.id, sequence.name)"
                [disabled]="predictionInProgress"
                style="outline: none; border: none; padding: 5px"
                placement="bottom"
                ngbTooltip="Delete sequence"
              >
                <span class="btn-label"
                  ><em class="bi bi-trash" style="font-size: 1.5rem"></em
                ></span>
              </button>
            </td>
            <td>
              <div
                *ngIf="
                  sequence.state === 'PENDING' &&
                  !(predictionInProgress && idBeingPredicted === sequence.id)
                "
              >
                <em class="bi bi-question-circle" style="font-size: 2rem"></em>
              </div>
              <div
                *ngIf="
                  sequence.state === 'POSITIVE' &&
                  !(predictionInProgress && idBeingPredicted === sequence.id)
                "
              >
                <em
                  class="bi bi-check-circle text-success"
                  style="font-size: 2rem"
                ></em>
              </div>
              <div
                *ngIf="
                  sequence.state === 'NEGATIVE' &&
                  !(predictionInProgress && idBeingPredicted === sequence.id)
                "
              >
                <em
                  class="bi bi-dash-circle text-danger"
                  style="font-size: 2rem"
                ></em>
              </div>
              <div
                *ngIf="predictionInProgress && idBeingPredicted === sequence.id"
                class="spinner-border"
                role="status"
              >
                <span class="visually-hidden">Loading...</span>
              </div>
            </td>
            <td
              style="word-wrap: break-word; min-width: 200px; max-width: 200px"
            >
              {{ sequence.value }}
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>
